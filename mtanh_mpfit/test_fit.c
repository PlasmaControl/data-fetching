// to compile,
// gcc -g -lm test_fit.c mtanh_mpfit_lin_core.c mpfit.c -o test_fit

#include <stdio.h>
#include "mtanh_mpfit_lin_core.h"

#define NOUT 121
#define FITTING_MAX_PAR 5 //also change in mpfit.c
#define FITTING_NRINGTHOM 41 //ditto
int main(void) {
  int i;
  int status;
  // dump from experiment with dump_inputs.py
  double ne_err[FITTING_NRINGTHOM] = {0.0, 0.06523630023002625, 0.07954816520214081, 0.06821983307600021, 0.0, 0.0, 0.08932763338088989, 0.09785978496074677, 0.09631725400686264, 0.1150461882352829, 0.0948479026556015, 0.11589352041482925, 0.10354575514793396, 0.09719431400299072, 0.12703734636306763, 0.14334659278392792, 0.13733741641044617, 0.14950795471668243, 0.1205669641494751, 0.12407523393630981, 0.0, 0.09888241440057755, 0.09541268646717072, 0.10781627148389816, 0.12334992736577988, 0.08738935738801956, 0.10368706285953522, 0.11454443633556366, 0.10245510190725327, 0.10518069565296173, 0.10105280578136444, 0.07684669643640518, 0.06600295752286911, 0.09164655953645706, 0.09341906756162643, 0.07722989469766617, 0.0936889722943306, 0.07984640449285507, 0.06867891550064087, 0.06529811769723892, 0.05405796319246292};
  double ne[FITTING_NRINGTHOM] = {0.0, 0.38156676292419434, 0.3289957046508789, 0.4557972848415375, 0.0, 0.0, 0.37786686420440674, 0.8080703020095825, 1.0294721126556396, 1.1459486484527588, 0.8792968392372131, 0.8570492267608643, 0.7042902708053589, 0.8366982340812683, 1.2809710502624512, 1.8310728073120117, 1.3600999116897583, 1.4476408958435059, 1.4166706800460815, 1.414399266242981, 0.0, 1.4489859342575073, 1.3492530584335327, 1.3456535339355469, 1.6573418378829956, 1.3324244022369385, 1.35603928565979, 1.8194093704223633, 1.7209868431091309, 1.7811620235443115, 1.8165216445922852, 1.6213829517364502, 1.7615491151809692, 1.8472286462783813, 2.078911066055298, 1.990086317062378, 2.0791409015655518, 2.328289270401001, 2.445871591567993, 2.5332298278808594, 2.3961384296417236};
  double psin[FITTING_NRINGTHOM] = {1.0796047449111938, 1.069106101989746, 1.0583276748657227, 1.046327829360962, 1.034943699836731, 1.0222680568695068, 1.0132778882980347, 1.008205771446228, 1.0010111331939697, 0.9958053827285767, 0.9884246587753296, 0.9820130467414856, 0.9744337201118469, 0.9689552187919617, 0.9611953496932983, 0.9544612169265747, 0.9465087056159973, 0.9396111369132996, 0.9326394200325012, 0.9255946278572083, 0.9160891175270081, 0.9100838303565979, 0.9003737568855286, 0.8930100798606873, 0.884333074092865, 0.8768230080604553, 0.8603266477584839, 0.8422288298606873, 0.825127363204956, 0.8037076592445374, 0.7819042801856995, 0.7372620105743408, 0.6638423800468445, 0.5326244831085205, 0.578405499458313, 0.4872515797615051, 0.44838640093803406, 0.3776807188987732, 0.2475687712430954, 0.14690156280994415, 0.1244959607720375};
  double presult[FITTING_MAX_PAR];
  double fit_results[NOUT*2];
  double *pfit,*ppsin;
  pfit=&fit_results[0*NOUT];
  ppsin=&fit_results[1*NOUT];
  status=mtanh_mpfit(FITTING_NRINGTHOM, psin, ne, ne_err, presult, ppsin, pfit);
  // compare to experiment with compare.py
  for (i=0; i<NOUT; i++)
    printf("%f, ",pfit[i]);
  printf("\n");
}
